<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="css/admin.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
</head>
<body>
    <div>
        <div class="sidebar">
           <h3>Device Management</h3>
           <a href="">Dashboard</a>
           <a href="">Logs</a>
           <a href="">Seting</a>
           
        </div>
        
        <div class="main">
          <div class="header"><b>Welcome John</b></div>
          <div class="content">
            <div class="table">
              <!-- <table >
                <tr>
                  <th>Devices</th>
                  <th>MAC Address</th>
                  <th>IP</th>
                  <th>Created Date</th>
                  <th>Power Consumption(Kw/H)</th>
                </tr>
                <tbody id="=myTable">

                </tbody>
                
              </table -->
              <table class="">
                  <tr  class="">
                      <th>Devices</th>
                      <th>MAC Address</th>
                      <th>IP</th>
                      <th>Created Date</th>
                      <th>Power Consumption(Kw/H)</th>
                  </tr>

                  <tbody id="myTable">
                      
                  </tbody>
              </table>
            </div>
            <div style="height: 100%;">
              <div class="chart">
                <canvas id="myChart" style="width:100%;max-width:600px"></canvas>
              </div>
              <div class="create_device">
                <form id="create_device">
                  <input type="text" class="name" id="name" name="name" placeholder="name">
                  <input type="text" name="ip" class="ip" id="ip" placeholder="IP">
                  <br>
                  <button type="button" class="btn_create" onclick="createDevice()">ADD DEVICE</button>
                </form>
              </div>
            </div>
          </div>
        </div>
    </div>
    
  
   
</body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript">

    //---------------------------------Hiển thị dữ liệu bảng-------------------------------//
    var jsonDevices =  [
                          {name:'TV', address:'00:1B44:11:3A:B7', ip:'127.0.0.2', date:'2021-05-31', consumption:60},
                          {name:'Washer', addres:'00:1B44:11:3A:B8', ip:'127.0.0.3', date:'2021-05-31', consumption:60},
                          {name:'Refriferator', address:'00:1B44:11:3A:B9', ip:'127.0.0.4', date:'2021-05-31', consumption:80},
                          {name:'Selling Fan', address:'00:1B44:11:3A:B2', ip:'127.0.0.5', date:'2021-05-31', consumption:100},
                        ]

    buildTable(jsonDevices)

    function buildTable(data){
      var table = document.getElementById('myTable');

      for (var i = 0; i < data.length; i++){
        var row = ` <tr>
                      <td>${data[i].name}</td>
                      <td>${data[i].address}</td>
                      <td>${data[i].ip}</td>
                      <td>${data[i].date}</td>
                      <td>${data[i].consumption}</td>
                    </tr>`
        table.innerHTML += row
      }
      //Tính tổng
      var total = 0;
      for (var i = 0; i < data.length; i++){
        var total = jsonDevices.map(jsonDevices => jsonDevices.consumption).reduce((acc, amount) => acc + amount);
  
      }

      var rowTotal = ` <tr>
                          <td colspan = "4">Total</td>
                          <td>${total}</td>
                       </tr>`
      table.innerHTML += rowTotal
    }

    //---------------------------------Vẽ biểu đồ-------------------------------//
    //Thêm chú thích tên của các màu
    var xValues = [];
    for (var i = 0; i < jsonDevices.length; i++){
        xValues.push(jsonDevices[i].name);
    }
    var yValues = [];
    for (var i = 0; i < jsonDevices.length; i++){
        yValues.push(jsonDevices[i].consumption);
    }
    //Các màu của biểu đồ
    var barColors = [
      "#b91d47",
      "#00aba9",
      "#2b5797",
      "#e8c3b9",
      
    ];

    new Chart("myChart", {
      type: "doughnut",
      data: {
        labels: xValues,
        datasets: [{
          backgroundColor: barColors,
          data: yValues
        }]
      },
      options: {
        title: {
          display: true,
          text: "World Wide Wine Production 2018"
        }
      }
    });

    //---------------------------------Thêm mới thiết bị-------------------------------//


    
    function Device(name, address, ip, date, consumption) {
      this.name = name;
      this.address = address;
      this.ip = ip;
      this.date = date;
      this.consumption = consumption;
    }

    var nameDevice = document.getElementById("name").value;
    var ipDevice = document.getElementById("ip").value;;
    var addressDevice= "";
    var dateDevice = "";
    var consumptionDevice = "";

    function createDevice(){
      var nameDevice = document.getElementById("name").value;
      var ipDevice = document.getElementById("ip").value;;
      var addressDevice= "";
      var dateDevice = "";
      var consumptionDevice = "";
        jsonDevices.push(new Device(nameDevice,ipDevice, addressDevice, dateDevice, consumptionDevice ));
        console.log(jsonDevices);
    }

    
    
    document.write(jsonDevices);
  </script>
</html> 
